(function(g){var c={debug:true};var o=c;var d={select:function(p){h(p,"a")},debug:false,swfupload:false,dirs:true,plugins:["imageresize"],w:700,h:500,bgcolor:"#F9F9F9",bgalpha:0.7};var b={image:{folder:"img/",allow:["jpg","jpeg","gif","png"],select:function(p){h(p,"img")},bgcolor:"#F9F9F9",resize:null},video:{folder:"vid/"},audio:{folder:"aud/"},media:{folder:""}};g.wpadminsfb=ww={id:"wpadminsfb",defaults:{debug:false,version:"1.2.3",siteUri:"",filePrefixUri:"",override:{},relativePath:false,insertionRules:"{}",sfbObject:{}},open:function(p){g.sfb(g.extend({},d,b[p]))},addInsertionRule:function(p){k(p)},remInsertionRule:function(p,q){l(p,q)},buildInsertionRule:function(p){e(p)}};g.fn.extend({wpadminsfb:function(s){g.extend(c,ww.defaults,s);f(g.wpadminsfb.id+" "+o.version,true);var r=o.filePrefixUri.split("/");var v=Math.max(0,r.length-2);var w="";for(var t=0;t<v;t++){w+="../"}o.prefix=o.relativePath?w:o.siteUri+"/";g.extend(d,o.sfbObject);if(o.resize){b.image.resize=o.resize}b.image.folder=o.imageFolder+"/";b.video.folder=o.videoFolder+"/";b.audio.folder=o.audioFolder+"/";b.media.folder=o.mediaFolder+"/";if(o.override.media){g("li#menu-media").remove();var x=g("#toplevel_page_sfbrowser_media");x.find(".wp-menu-image img").remove();x.find(">a").removeAttr("href").click(function(y){g.sfb(d)})}if(o.override.feature){var q=function q(y){y.removeAttr("onclick").removeAttr("href").css({textDecoration:"underline"}).removeClass("thickbox").click(function(A){var z=g.extend({},d,b.image);z.select=function(B){var C=B[0];if(C.wpPostsId){WPSetAsThumbnail(C.wpPostsId,o.featurenonce)}else{alert("A file has to be present in the Worpress media library. Click the Wordpress icon in the file browser to do so.");return false}};g.sfb(z)})};$FiA=g("a#set-post-thumbnail");q($FiA);$FiA.parents("div.inside").contentChange(function(y){q(g(this).find("#set-post-thumbnail"))})}g(window).load(function(){n();try{tinyMCE&&tinyMCE.activeEditor&&tinyMCE.activeEditor.onChange.add(n);g("#edButtonPreview").click(n)}catch(y){f("tinyMCE not found",true)}});g.each(["image","video","audio","media"],function(y,A){var z=g("#sfbrowser_overrideTinyMCE"+y);if(!z.is(":checked")){g("#sfbrowser_"+A+"Directory").parents("tr:first").hide()}z.change(function(){var B=g("#sfbrowser_"+A+"Directory").parents("tr:first");if(!g(this).is(":checked")){B.hide("fast")}else{B.show("fast")}})});var p=g("#sfbrowser_featureImage");var u=g("#sfbrowser_plugins3");p.change(function(y){if(g(this).is(":checked")){u.attr("checked","checked")}});u.change(function(y){if(g(this).not(":checked")){p.removeAttr("checked")}})}});function h(x,p){var u=x[0].mime;var r="";g.each(o.insertionRules,function(z,E){if(E.e.indexOf(u)!==-1){if(x.length>1){var A=E.m.split("|");r=A[0];var y=A[0];if(A.length>1){r=A[0];y=A[1]}if(y==""){y=E.s}g.each(x,function(G,H){var J=m(H);var I=J.split("/").pop().replace("."+H.mime,"");var F=y.replace("%file",o.prefix+J).replace("%name",I);g.each(H,function(L,K){if(L!="file"){F=F.replace("%"+L,K)}});r+=F+"\n"});if(A.length>2){r+=A[0]}r+="\n"}else{var B=x[0];var D=m(B);var C=D.split("/").pop().replace("."+B.mime,"");r=E.s.replace("%file",o.prefix+D).replace("%name",C);g.each(B,function(G,F){if(G!="file"){r=r.replace("%"+G,F)}});r+="\n"}}});if(r==""){var v=m(x[0]);r='<img src="'+o.prefix+v+'" />';switch(p){case"a":if(x.length>1){r="<ul>";for(var t=0;t<x.length;t++){var v=m(x[t]);r+='<li><a href="'+o.prefix+v+'">'+v.split("/").pop()+"</a></li>"}r+="</ul>"}else{r='<a href="'+o.prefix+v+'">'+v.split("/").pop()+"</a>"}break}}var s=g("#dashboard_quick_press");if(s.length===0){try{tinyMCE.activeEditor.selection.setContent(r);n()}catch(w){try{edInsertContent(edCanvas,r)}catch(q){f("tinyMCE seems not present "+q)}}}else{a(s.find("#content").get(0),r)}}function m(p){return p.file.replace("..data/",o.siteUri+"/data/").replace("../","").replace("//","/")}function n(){g("iframe").contents().find("body img").each(function(){var p=g(this).attr("src");if(p.substr(0,3)!="../"){g(this).attr("src","../"+p)}})}function a(w,u){var v=w.scrollTop;var s=0;var r=((w.selectionStart||w.selectionStart=="0")?"ff":(document.selection?"ie":false));if(r=="ie"){w.focus();var q=document.selection.createRange();q.moveStart("character",-w.value.length);s=q.text.length}else{if(r=="ff"){s=w.selectionStart}}var t=(w.value).substring(0,s);var p=(w.value).substring(s,w.value.length);w.value=t+u+p;s=s+u.length;if(r=="ie"){w.focus();var q=document.selection.createRange();q.moveStart("character",-w.value.length);q.moveStart("character",s);q.moveEnd("character",0);q.select()}else{if(r=="ff"){w.selectionStart=s;w.selectionEnd=s;w.focus()}}w.scrollTop=v}function k(p){g(g("#insertionAdd").val()).insertBefore(g(p))}function l(p,q){g(p).parents("p:first").remove();e(q)}function e(s){var q=g("#"+s);var p=q.parent().find(".insertionRule");var r={};p.each(function(v,w){var u=g(w);var y=u.find(".sfbir_e").val();var t=u.find(".sfbir_s").val();var x=u.find(".sfbir_m").val();if(!(y==""||t=="")){r["rule_"+v]={e:y,s:t,m:x}}});q.val(JSON.stringify(r))}function j(r,p,q){f("sfb ajax error "+r+" "+p+" "+q)}function f(q,p){if((p||o.debug)&&window.console&&window.console.log){if(typeof(q)=="string"){window.console.log(q)}else{for(var r in q){window.console.log(r+":\t"+String(q[r]).split("\n")[0])}}}}})(jQuery);(function(a){a(function(){setInterval(function(){if(window.watchContentChange){for(i in window.watchContentChange){if(window.watchContentChange[i].element&&window.watchContentChange[i].element.data("lastContents")!=window.watchContentChange[i].element.html()){window.watchContentChange[i].callback.apply(window.watchContentChange[i].element);window.watchContentChange[i].element.data("lastContents",window.watchContentChange[i].element.html())}}}},500)});a.fn.extend({contentChange:function(c){var b=a(this);b.each(function(d){var e=jQuery(this);e.data("lastContents",e.html());window.watchContentChange=window.watchContentChange?window.watchContentChange:[];window.watchContentChange.push({element:e,callback:c})});return b}})})(jQuery);